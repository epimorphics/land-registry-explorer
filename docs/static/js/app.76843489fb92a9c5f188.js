webpackJsonp([1],{140:function(e,t){},141:function(e,t){},142:function(e,t){},143:function(e,t){},144:function(e,t){},145:function(e,t){},146:function(e,t){},150:function(e,t,n){function o(e){n(144)}var r=n(12)(n(85),n(155),o,"data-v-3cc16e99",null);e.exports=r.exports},151:function(e,t,n){function o(e){n(143)}var r=n(12)(n(86),n(154),o,null,null);e.exports=r.exports},152:function(e,t,n){function o(e){n(145)}var r=n(12)(n(87),n(156),o,null,null);e.exports=r.exports},153:function(e,t,n){var o=n(12)(n(83),n(157),null,null,null);e.exports=o.exports},154:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"result-view"},["data"===e.activeView?n("div",{attrs:{id:"visualization"}},[e._m(0),e._v(" "),e._m(1)]):"json"===e.activeView?n("div",{staticClass:"result-view",attrs:{id:"json"}},[n("pre",[e._v(e._s(e.message))]),e._v(" "),n("pre",[e._v(e._s(e.result))])]):e._e()])},staticRenderFns:[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"rowChartDataTable"}},[n("div",{staticClass:"row"},[n("span",{staticClass:"title"},[e._v("Number of Sales per Property Type")]),e._v(" "),n("div",{attrs:{id:"rowChart"}})]),e._v(" "),n("div",{staticClass:"grid"},[n("span",{staticClass:"title"},[e._v("Latest Property Sale")]),e._v(" "),n("div",{attrs:{id:"dataGrid"}})])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bar"},[n("span",{staticClass:"title"},[e._v("Average Price Paid per Year")]),e._v(" "),n("div",{attrs:{id:"barChart"}})])}]}},155:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"google-map",attrs:{id:"gmap"}})},staticRenderFns:[]}},156:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sparql-console"},[n("codemirror",{attrs:{id:"codemirror",options:e.editorOption},on:{changes:e.onEditorChanges,beforeChange:e.onEditorBeforeChange,beforeSelectionChange:e.onEditorBeforeSelectionChange},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}}),e._v(" "),n("div",{staticClass:"my-fab"},[n("md-button",{staticClass:"md-fab md-primary",on:{click:e.runQuery}},[n("md-icon",[e._v("play_arrow")])],1)],1)],1)},staticRenderFns:[]}},157:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("textarea")},staticRenderFns:[]}},158:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",[n("md-input-container",[n("label",[e._v("Postcode")]),e._v(" "),n("md-input",{model:{value:e.selectedPostcode,callback:function(t){e.selectedPostcode=t},expression:"selectedPostcode"}})],1)],1),e._v(" "),n("div",["map"===e.currentView?n("div",[n("GoogleMap",{ref:"gmap",attrs:{id:"gmap"}})],1):"query"===e.currentView?n("div",[n("SparqlConsole",{attrs:{id:"console"},on:{runQuery:e.runQuery}})],1):n("div",[n("ResultView",{attrs:{id:"result"}})],1)]),e._v(" "),n("md-bottom-bar",[n("md-bottom-bar-item",{attrs:{"md-icon":"map",id:"map-button","md-active":""},on:{click:function(t){e.currentView="map"}}},[e._v("Map")]),e._v(" "),n("md-bottom-bar-item",{attrs:{"md-icon":"code",id:"query-button"},on:{click:function(t){e.currentView="query"}}},[e._v("Query")]),e._v(" "),n("md-bottom-bar-item",{attrs:{"md-icon":"equalizer",id:"result-button"},on:{click:e.runQuery}},[e._v("Result")])],1)],1)},staticRenderFns:[]}},161:function(e,t){},59:function(e,t,n){function o(e){n(146)}var r=n(12)(n(84),n(158),o,null,null);e.exports=r.exports},82:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(57),r=n.n(o),i=n(36),s=n(61),a=n(60),u=n.n(a),c=n(58),d=n.n(c),l=n(59),p=n.n(l);r.a.polyfill(),i.default.config.productionTip=!1,i.default.use(s.a),i.default.use(u.a),i.default.use(d.a);var f=new s.a.Store({state:{postcode:"",queryPrefix:'prefix xsd: <http://www.w3.org/2001/XMLSchema#>\nprefix ukhpi: <http://landregistry.data.gov.uk/def/ukhpi/>\nprefix lrppi: <http://landregistry.data.gov.uk/def/ppi/>\nprefix skos: <http://www.w3.org/2004/02/skos/core#>\nprefix lrcommon: <http://landregistry.data.gov.uk/def/common/>\n\nSELECT ?paon ?saon ?street ?town ?county ?propertyType ?postcode ?amount ?date ?category\nWHERE\n{\n  VALUES ?postcode {"',queryPostfix:'"^^xsd:string}\n\n  ?addr lrcommon:postcode ?postcode.\n\n  ?transx lrppi:propertyAddress ?addr ;\n  lrppi:pricePaid ?amount ;\n  lrppi:propertyType/skos:prefLabel ?propertyType ;\n  lrppi:transactionDate ?date ;\n  lrppi:transactionCategory/skos:prefLabel ?category.\n\n  OPTIONAL {?addr lrcommon:county ?county}\n  OPTIONAL {?addr lrcommon:paon ?paon}\n  OPTIONAL {?addr lrcommon:saon ?saon}\n  OPTIONAL {?addr lrcommon:street ?street}\n  OPTIONAL {?addr lrcommon:town ?town}\n}',queryResult:{},queryStatusCode:0},mutations:{updatePostcode:function(e,t){e.postcode=t},updateQueryResult:function(e,t){e.queryResult=t},updateQueryStatusCode:function(e,t){e.queryStatusCode=t},updateQueryPrefix:function(e,t){e.queryPrefix=t},updateQueryPostfix:function(e,t){e.queryPostfix=t}},getters:{code:function(e){return e.queryPrefix+e.postcode+e.queryPostfix},queryResult:function(e){return e.queryResult}}});new i.default({el:"#app",store:f,template:"<App/>",components:{App:p.a}})},83:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(92),r=n.n(o);window.CodeMirror=n(13),n(140),n(43),t.default={name:"codemirror",data:function(){return{content:""}},props:{code:String,value:String,unseenLines:Array,marker:Function,loadtheme:{type:Boolean,default:function(){return!0}},debugger:{type:Boolean,default:function(){return!0}},options:{type:Object,required:!0}},created:function(){void 0===this.options.lineNumbers&&(this.options.lineNumbers=!0),void 0===this.options.lineWrapping&&(this.options.lineWrapping=!1),void 0===this.options.mode&&(this.options.mode="text/javascript");var e=this.options.theme,t=this.options.mode,o=this.debugger,i=this.loadtheme,s=!!CodeMirror.modes[t];if(e&&"solarized light"==e&&(e="solarized"),"string"==typeof t){var a=CodeMirror.findModeByMIME(t);t=a?a.mode:a}else if("object"==(void 0===t?"undefined":r()(t)))if(t.name){var a=CodeMirror.findModeByName(t.name);t=a?a.mode:null}else if(t.ext){var a=CodeMirror.findModeByExtension(t.ext);t=a?a.mode:null}else if(t.mime){var a=CodeMirror.findModeByMIME(t.mime);t=a?a.mode:null}else if(t.filename){var a=CodeMirror.findModeByFileName(t.filename);t=a?a.mode:null}t&&"null"!=t||!o||s||console.warn("CodeMirror language mode: "+t+" configuration error (CodeMirror语言模式配置错误，或者不支持此语言) See http://codemirror.net/mode/ for more details."),t&&"null"!==t&&n(95)("./"+t+"/"+t+".js"),e&&i&&n(97)("./"+e+".css")},mounted:function(){var e=this;this.editor=CodeMirror.fromTextArea(this.$el,this.options),this.editor.setValue(this.code||this.value||this.content),this.editor.on("change",function(t){e.content=t.getValue(),e.$emit&&(e.$emit("change",e.content),e.$emit("input",e.content))});for(var t=["changes","beforeChange","cursorActivity","keyHandled","inputRead","electricInput","beforeSelectionChange","viewportChange","swapDoc","gutterClick","gutterContextMenu","focus","blur","refresh","optionChange","scrollCursorIntoView","update"],n=t.length-1;n>=0;n--)!function(t){e.editor.on(t,function(n,o,r){e.$emit(t,n,o,r)})}(t[n]);this.$emit("ready",this.editor),this.unseenLineMarkers(),window.setTimeout(function(){e.editor.refresh()},0)},beforeDestroy:function(){var e=this.editor.doc.cm.getWrapperElement();e&&e.remove&&e.remove()},watch:{options:{deep:!0,handler:function(e,t){var n;for(n in e)this.editor.setOption(n,e[n])}},code:function(e,t){if(e!==this.editor.getValue()){var n=this.editor.getScrollInfo();this.editor.setValue(e),this.content=e,this.editor.scrollTo(n.left,n.top)}this.unseenLineMarkers()},value:function(e,t){if(e!==this.editor.getValue()){var n=this.editor.getScrollInfo();this.editor.setValue(e),this.content=e,this.editor.scrollTo(n.left,n.top)}this.unseenLineMarkers()}},methods:{refresh:function(){this.editor.refresh()},unseenLineMarkers:function(){var e=this;void 0!==e.unseenLines&&void 0!==e.marker&&e.unseenLines.forEach(function(t){var n=e.editor.lineInfo(t);e.editor.setGutterMarker(t,"breakpoints",n.gutterMarkers?null:e.marker())})}}}},84:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(89),r=n.n(o),i=n(150),s=n.n(i),a=n(152),u=n.n(a),c=n(151),d=n.n(c),l=n(37);t.default={name:"app",data:function(){return{currentView:"map"}},components:{GoogleMap:s.a,SparqlConsole:u.a,ResultView:d.a},methods:{openResult:function(){document.getElementById("result-button").click()},runQuery:function(){var e=this,t="http://landregistry.data.gov.uk/landregistry/query?query="+encodeURIComponent(e.code);l.get(t,{headers:{Accept:"application/sparql-results+json"}}).then(function(t){var n=e.parseQueryResult(t.data.results.bindings);e.$store.commit("updateQueryStatusCode",t.status),e.$store.commit("updateQueryResult",n)}).catch(function(t){t&&(e.$store.commit("updateQueryStatusCode",t.response.status),e.$store.commit("updateQueryResult",t.response.data))})},parseQueryResult:function(e){var t=this;return e.map(function(e){var n={};return r()(e).forEach(function(o){n[o]=t.dataTypeCast(e[o])}),n})},dataTypeCast:function(e){var t=e.value;if(void 0===e.datatype)return t;switch(e.datatype.replace("http://www.w3.org/2001/XMLSchema#","")){case"string":t=new String(t);break;case"boolean":t=new Boolean("false"!==t&&t);break;case"float":case"integer":case"long":case"double":case"decimal":case"nonPositiveInteger":case"nonNegativeInteger":case"negativeInteger":case"int":case"unsignedLong":case"positiveInteger":case"short":case"unsignedInt":case"byte":case"unsignedShort":case"unsignedByte":t=new Number(t);break;case"date":case"time":case"dateTime":t=new Date(t)}return t}},computed:{selectedPostcode:{get:function(){return this.$store.state.postcode},set:function(e){this.$store.commit("updatePostcode",e)}},queryResult:{get:function(){return this.$store.state.queryResult}},code:{get:function(){return this.$store.getters.code}}},watch:{queryResult:function(){this.currentView="result"}}}},85:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(94),r=n(62),i=n(63),s=n(134),a=n(37),u=n(93);t.default={name:"google-map",data:function(){return{visiblePostcodes:[],map:{},mapCenter:new window.google.maps.LatLng(51.46040383078197,-2.6015971891367826),infoWindow:new window.google.maps.InfoWindow,populatingData:!1}},mounted:function(){this.updateMapCenter();var e=this,t=document.getElementById("gmap"),n={zoom:17,center:this.mapCenter,disableDefaultUI:!0,zoomControl:!0,minZoom:17,maxZoom:18},o=new window.google.maps.Map(t,n);o.addListener("idle",function(){e.populatingData||(e.mapCenter=o.getCenter(),e.getNearbyPostcodes())}),e.map=o},methods:{updateMapCenter:function(){var e=this;if(!(this.postcode.length<6)){var t="https://api.postcodes.io/postcodes/"+this.postcode;return a.get(t).then(function(t){e.mapCenter=new window.google.maps.LatLng(t.data.result.latitude,t.data.result.longitude)}).catch(function(e){console.log(e)})}},getNearbyPostcodes:function(){var e=this;this.visiblePostcodes=[];var t="https://api.postcodes.io/postcodes?lon="+this.mapCenter.lng()+"&lat="+this.mapCenter.lat()+"&radius=300&limit=99";a.get(t).then(function(t){t.data.result.forEach(function(t){var n=r.point([t.longitude,t.latitude]);n.id=t.postcode,e.visiblePostcodes.push(n)})}).then(function(){e.populateURLs()}).catch(function(e){console.log(e)})},populateURLs:function(){this.visiblePostcodes.forEach(function(e){var t="http://landregistry.data.gov.uk/data/ppi/transaction-record.json?_page=0&propertyAddress.postcode="+e.id+"&_pageSize=50";t=t.replace(" ","%20"),e.properties.url=t}),this.getData()},getData:function(){var e=this;u.map(this.visiblePostcodes,function(e){return a.get(e.properties.url).then(function(t){var n=0,o=t.data.result.items;o.forEach(function(e){n+=e.pricePaid}),e.properties.averagePaid=n?n/o.length:0}).catch(function(e){console.log(e)})},{concurrency:10}).then(function(){e.generateVoronoi()})},generateVoronoi:function(){var e=this,t=[];this.visiblePostcodes.forEach(function(e){t.push(e.geometry.coordinates)});var n=this.map.getBounds().getNorthEast().lat()+.005,o=this.map.getBounds().getNorthEast().lng()+.005,a=this.map.getBounds().getSouthWest().lat()-.005,u=this.map.getBounds().getSouthWest().lng()-.005,c=s.voronoi().extent([[u,a],[o,n]]),d=c(t).polygons(),l=[];d.forEach(function(t){t.reverse().push(t[0]);var n=r.polygon([t]);e.visiblePostcodes.forEach(function(e){i(e,n)&&(n.id=e.id,n.properties=e.properties,n.properties.centroid=e.geometry.coordinates)}),l.push(n)}),this.clearShapes(),this.visiblePostcodes=l,this.populateData()},clearShapes:function(){var e=this;this.map.data.forEach(function(t){e.map.data.remove(t)}),this.visiblePostcodes=[]},populateData:function(){var e=this,t=1/0,n=-1/0;this.visiblePostcodes.forEach(function(o){e.map.data.addGeoJson(o),o.properties.averagePaid>n&&(n=o.properties.averagePaid),o.properties.averagePaid<t&&(t=o.properties.averagePaid)}),this.setPolygonsColor(t,n)},setPolygonsColor:function(e,t){var n=o.scale(["#E8FF3C","#FF4500","#D90000"]);this.map.data.setStyle(function(o){var r=o.getProperty("averagePaid"),i=(r-e)/(t-e);return{fillColor:r?n(i):"#ffffff",strokeWeight:1}}),this.setOnFeatureClickListener()},setOnFeatureClickListener:function(){var e=this;this.map.data.addListener("click",function(t){e.infoWindow&&e.infoWindow.close();var n=t.feature.getProperty("centroid"),o=e.prettyPrintCurrency(t.feature.getProperty("averagePaid")),r="<p><b>"+t.feature.getId()+"</b></p><p>Average Price Paid: "+o+"</p>";e.infoWindow=new window.google.maps.InfoWindow({content:r,position:new window.google.maps.LatLng(n[1],n[0])}),e.postcode=t.feature.getId(),e.infoWindow.open(e.map)}),this.populatingData=!1},prettyPrintCurrency:function(e){return e.toLocaleString("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:2})}},computed:{postcode:{get:function(){return this.$store.state.postcode},set:function(e){this.$store.commit("updatePostcode",e)}}},watch:{mapCenter:function(){this.map.panTo(this.mapCenter)},postcode:function(e){var t=this;e.length>5&&(this.populatingData=!0,this.updateMapCenter().then(function(){t.getNearbyPostcodes()}))}}}},86:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(139),r=n(56),i=n(131);t.default={data:function(){return{result:this.$store.state.queryResult,statusCode:this.$store.state.queryStatusCode,message:"",requiredFields:["paon","street","town","county","propertyType","postcode","amount","date"],activeView:"data"}},mounted:function(){var e=this;if(this.statusCode>399)return this.message="",void(this.activeView="json");if(0===this.result.length)this.message="No sales in "+this.postcode+" since 01/01/1995",this.activeView="json";else{this.requiredFields.every(function(t){return e.result[0].hasOwnProperty(t)})?this.visualizeData():(this.message="To visualize the data please return all of the following fields:\npaon, street, town, county, propertyType, postcode, amount, date\n\nQuery Result as JSON:",this.activeView="json")}},methods:{visualizeData:function(){for(var e=o.rowChart("#rowChart"),t=o.barChart("#barChart"),n=o.dataGrid("#dataGrid"),s=i(this.result),a=s.dimension(function(e){return e.propertyType}),u=a.group().reduceCount(function(e){return e.amount}),c=s.dimension(function(e){return e.date.toString().substring(11,15)}),d=c.group().reduce(function(e,t){return++e.count,e.total+=t.amount,e.average=e.count?e.total/e.count:0,e},function(e,t){return--e.count,e.total-=t.amount,e.average=e.count?e.total/e.count:0,e},function(){return{count:0,total:0,average:0}}),l=s.dimension(function(e){return e.date.getTime()}),p=[],f=1995;f<2018;f++)p.push(f.toString());e.width(260).height(200).group(u).dimension(a).ordinalColors(["#005E00","#0F8500","#35AB17","#5BD13D","#81F763"]).title(function(e){return e.propertyType}).elasticX(!0).turnOnControls(!0),e.xAxis().ticks(5).tickSize(2).tickPadding(10),t.width(500).height(215).dimension(c).group(d).valueAccessor(function(e){return e.value.average}).x(r.scale.ordinal().domain(p)).xUnits(o.units.ordinal).elasticY(!0).yAxisLabel("").elasticX(!0).xAxisLabel("Year").renderHorizontalGridLines(!0).gap(1).centerBar(!1).margins({top:10,right:0,bottom:45,left:65}),t.xAxis().tickFormat(function(e){return"'"+e.substring(2,4)}).tickSize(2).tickPadding(10),t.yAxis().tickFormat(function(e){return e.toLocaleString("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0,minimumFractionDigits:0})}).tickSize(2),n.dimension(l).group(function(e){return e.propertyType}).html(function(e){return"<div><b>Address:</b> "+e.paon+" "+e.street+"</div><div><b>Town:</b> "+e.town+"</div><div><b>County:</b> "+e.county+"</div><div><b>Property Type:</b> "+e.propertyType+"</div><div><b>Price Paid:</b> "+e.amount.toLocaleString("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:2})+"</div><div><b>Date:</b> "+e.date.getDate()+"/"+(e.date.getMonth()+1)+"/"+e.date.getFullYear()+"</div>"}).sortBy(function(e){return e.date.getTime()}).size(1),o.renderAll()}},computed:{postcode:{get:function(){return this.$store.state.postcode},set:function(e){this.$store.commit("updatePostcode",e)}}}}},87:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(88),r=n.n(o);t.default={data:function(){return{editorOption:{inputStyle:"contenteditable",tabSize:2,foldGutter:!0,styleActiveLine:!0,lineNumbers:!0,line:!0,matchBrackets:!0,mode:"application/sparql-query",theme:"base16-light"}}},methods:{runQuery:function(){document.getElementById("result-button").click()},getIndexAt:function(e,t,n){for(var o=0,r=0;r<e.length;r++)if("\n"!==e[r]){if(o===t)return r+n}else o++},onEditorBeforeSelectionChange:function(e,t){var n=JSON.parse(r()(t.ranges));n[0].head=JSON.parse(r()(t.ranges[0].anchor)),t.update(n)},onEditorBeforeChange:function(e,t){"+delete"!==t.origin&&"+input"!==t.origin&&"setValue"!==t.origin&&t.cancel()},onEditorChanges:function(e,t){for(var n=e.getValue(),o=this.queryPrefix.length,r=o+this.postcode.length,i=0;i<t.length;i++){var s=t[i],a=this.getIndexAt(e.getValue(),s.from.line,s.from.ch);"+delete"===s.origin?a<o?this.queryPrefix=n.substring(0,o-1):a<r?this.postcode=n.substring(o,r-1):this.queryPostfix=n.substring(r,n.length):"+input"===s.origin&&(a<o?this.queryPrefix=n.substring(0,o+1):a<=r?this.postcode=n.substring(o,r+1):this.queryPostfix=n.substring(r,n.length))}}},computed:{postcode:{get:function(){return this.$store.state.postcode},set:function(e){this.$store.commit("updatePostcode",e)}},code:{get:function(){return this.$store.getters.code}},queryPrefix:{get:function(){return this.$store.state.queryPrefix},set:function(e){this.$store.commit("updateQueryPrefix",e)}},queryPostfix:{get:function(){return this.$store.state.queryPostfix},set:function(e){this.$store.commit("updateQueryPostfix",e)}}}}},95:function(e,t,n){function o(e){return n(r(e))}function r(e){var t=i[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var i={"./meta.js":43,"./sparql/sparql.js":96};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=95},97:function(e,t,n){function o(e){return n(r(e))}function r(e){var t=i[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var i={"./base16-dark.css":141,"./base16-light.css":142};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=97}},[82]);
//# sourceMappingURL=app.76843489fb92a9c5f188.js.map