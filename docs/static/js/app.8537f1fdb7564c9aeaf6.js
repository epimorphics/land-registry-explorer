webpackJsonp([1],{140:function(e,t){},141:function(e,t){},142:function(e,t){},143:function(e,t){},144:function(e,t){},145:function(e,t){},146:function(e,t){},150:function(e,t,o){function n(e){o(144)}var r=o(12)(o(86),o(155),n,"data-v-3cc16e99",null);e.exports=r.exports},151:function(e,t,o){function n(e){o(143)}var r=o(12)(o(87),o(154),n,null,null);e.exports=r.exports},152:function(e,t,o){function n(e){o(145)}var r=o(12)(o(88),o(156),n,null,null);e.exports=r.exports},153:function(e,t,o){var n=o(12)(o(84),o(157),null,null,null);e.exports=n.exports},154:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"result-view"},["data"===e.activeView?o("div",{attrs:{id:"visualization"}},[e._m(0),e._v(" "),e._m(1)]):"json"===e.activeView?o("div",{staticClass:"result-view",attrs:{id:"json"}},[o("pre",[e._v(e._s(e.message))]),e._v(" "),o("pre",[e._v(e._s(e.result))])]):e._e()])},staticRenderFns:[function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"rowChartDataTable"}},[o("div",{staticClass:"row"},[o("span",{staticClass:"title"},[e._v("Number of Sales per Property Type")]),e._v(" "),o("div",{attrs:{id:"rowChart"}})]),e._v(" "),o("div",{staticClass:"grid"},[o("span",{staticClass:"title"},[e._v("Latest Property Sale")]),e._v(" "),o("div",{attrs:{id:"dataGrid"}})])])},function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"bar"},[o("span",{staticClass:"title"},[e._v("Average Price Paid per Year")]),e._v(" "),o("div",{attrs:{id:"barChart"}})])}]}},155:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"google-map",attrs:{id:"gmap"}})},staticRenderFns:[]}},156:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"sparql-console"},[o("codemirror",{attrs:{id:"codemirror",options:e.editorOption},on:{changes:e.onEditorChanges,beforeChange:e.onEditorBeforeChange,beforeSelectionChange:e.onEditorBeforeSelectionChange},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}}),e._v(" "),o("div",{staticClass:"my-fab"},[o("md-button",{staticClass:"md-fab md-primary",on:{click:e.runQuery}},[o("md-icon",[e._v("play_arrow")])],1)],1)],1)},staticRenderFns:[]}},157:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("textarea")},staticRenderFns:[]}},158:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("div",[o("md-input-container",[o("label",[e._v("Postcode")]),e._v(" "),o("md-input",{model:{value:e.selectedPostcode,callback:function(t){e.selectedPostcode=t},expression:"selectedPostcode"}})],1)],1),e._v(" "),o("div",["map"===e.currentView?o("div",[o("GoogleMap",{ref:"gmap",attrs:{id:"gmap"}})],1):"query"===e.currentView?o("div",[o("SparqlConsole",{attrs:{id:"console"},on:{runQuery:e.runQuery}})],1):o("div",[o("ResultView",{attrs:{id:"result"}},[e._v("Results can be interesting")])],1)]),e._v(" "),o("md-bottom-bar",[o("md-bottom-bar-item",{attrs:{"md-icon":"map",id:"map-button","md-active":""},on:{click:function(t){e.currentView="map"}}},[e._v("Map")]),e._v(" "),o("md-bottom-bar-item",{attrs:{"md-icon":"code",id:"query-button"},on:{click:function(t){e.currentView="query"}}},[e._v("Query")]),e._v(" "),o("md-bottom-bar-item",{attrs:{"md-icon":"equalizer",id:"result-button"},on:{click:e.runQuery}},[e._v("Result")])],1)],1)},staticRenderFns:[]}},161:function(e,t){},60:function(e,t,o){function n(e){o(146)}var r=o(12)(o(85),o(158),n,null,null);e.exports=r.exports},83:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(58),r=o.n(n),i=o(36),s=o(62),a=o(61),u=o.n(a),c=o(59),d=o.n(c),l=o(60),p=o.n(l);r.a.polyfill(),i.default.config.productionTip=!1,i.default.use(s.a),i.default.use(u.a),i.default.use(d.a);var f=new s.a.Store({state:{postcode:"",queryPrefix:'prefix xsd: <http://www.w3.org/2001/XMLSchema#>\nprefix ukhpi: <http://landregistry.data.gov.uk/def/ukhpi/>\nprefix lrppi: <http://landregistry.data.gov.uk/def/ppi/>\nprefix skos: <http://www.w3.org/2004/02/skos/core#>\nprefix lrcommon: <http://landregistry.data.gov.uk/def/common/>\n\nSELECT ?paon ?saon ?street ?town ?county ?propertyType ?postcode ?amount ?date ?category\nWHERE\n{\n  VALUES ?postcode {"',queryPostfix:'"^^xsd:string}\n\n  ?addr lrcommon:postcode ?postcode.\n\n  ?transx lrppi:propertyAddress ?addr ;\n  lrppi:pricePaid ?amount ;\n  lrppi:propertyType/skos:prefLabel ?propertyType ;\n  lrppi:transactionDate ?date ;\n  lrppi:transactionCategory/skos:prefLabel ?category.\n\n  OPTIONAL {?addr lrcommon:county ?county}\n  OPTIONAL {?addr lrcommon:paon ?paon}\n  OPTIONAL {?addr lrcommon:saon ?saon}\n  OPTIONAL {?addr lrcommon:street ?street}\n  OPTIONAL {?addr lrcommon:town ?town}\n}',queryResult:{},queryStatusCode:0},mutations:{updatePostcode:function(e,t){e.postcode=t},updateQueryResult:function(e,t){e.queryResult=t},updateQueryStatusCode:function(e,t){e.queryStatusCode=t},updateQueryPrefix:function(e,t){e.queryPrefix=t},updateQueryPostfix:function(e,t){e.queryPostfix=t}},getters:{code:function(e){return e.queryPrefix+e.postcode+e.queryPostfix},queryResult:function(e){return e.queryResult}}});new i.default({el:"#app",store:f,template:"<App/>",components:{App:p.a}})},84:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(92),r=o.n(n);window.CodeMirror=o(13),o(140),o(44),t.default={name:"codemirror",data:function(){return{content:""}},props:{code:String,value:String,unseenLines:Array,marker:Function,loadtheme:{type:Boolean,default:function(){return!0}},debugger:{type:Boolean,default:function(){return!0}},options:{type:Object,required:!0}},created:function(){void 0===this.options.lineNumbers&&(this.options.lineNumbers=!0),void 0===this.options.lineWrapping&&(this.options.lineWrapping=!1),void 0===this.options.mode&&(this.options.mode="text/javascript");var e=this.options.theme,t=this.options.mode,n=this.debugger,i=this.loadtheme,s=!!CodeMirror.modes[t];if(e&&"solarized light"==e&&(e="solarized"),"string"==typeof t){var a=CodeMirror.findModeByMIME(t);t=a?a.mode:a}else if("object"==(void 0===t?"undefined":r()(t)))if(t.name){var a=CodeMirror.findModeByName(t.name);t=a?a.mode:null}else if(t.ext){var a=CodeMirror.findModeByExtension(t.ext);t=a?a.mode:null}else if(t.mime){var a=CodeMirror.findModeByMIME(t.mime);t=a?a.mode:null}else if(t.filename){var a=CodeMirror.findModeByFileName(t.filename);t=a?a.mode:null}t&&"null"!=t||!n||s||console.warn("CodeMirror language mode: "+t+" configuration error (CodeMirror语言模式配置错误，或者不支持此语言) See http://codemirror.net/mode/ for more details."),t&&"null"!==t&&o(95)("./"+t+"/"+t+".js"),e&&i&&o(97)("./"+e+".css")},mounted:function(){var e=this;this.editor=CodeMirror.fromTextArea(this.$el,this.options),this.editor.setValue(this.code||this.value||this.content),this.editor.on("change",function(t){e.content=t.getValue(),e.$emit&&(e.$emit("change",e.content),e.$emit("input",e.content))});for(var t=["changes","beforeChange","cursorActivity","keyHandled","inputRead","electricInput","beforeSelectionChange","viewportChange","swapDoc","gutterClick","gutterContextMenu","focus","blur","refresh","optionChange","scrollCursorIntoView","update"],o=t.length-1;o>=0;o--)!function(t){e.editor.on(t,function(o,n,r){e.$emit(t,o,n,r)})}(t[o]);this.$emit("ready",this.editor),this.unseenLineMarkers(),window.setTimeout(function(){e.editor.refresh()},0)},beforeDestroy:function(){var e=this.editor.doc.cm.getWrapperElement();e&&e.remove&&e.remove()},watch:{options:{deep:!0,handler:function(e,t){var o;for(o in e)this.editor.setOption(o,e[o])}},code:function(e,t){if(e!==this.editor.getValue()){var o=this.editor.getScrollInfo();this.editor.setValue(e),this.content=e,this.editor.scrollTo(o.left,o.top)}this.unseenLineMarkers()},value:function(e,t){if(e!==this.editor.getValue()){var o=this.editor.getScrollInfo();this.editor.setValue(e),this.content=e,this.editor.scrollTo(o.left,o.top)}this.unseenLineMarkers()}},methods:{refresh:function(){this.editor.refresh()},unseenLineMarkers:function(){var e=this;void 0!==e.unseenLines&&void 0!==e.marker&&e.unseenLines.forEach(function(t){var o=e.editor.lineInfo(t);e.editor.setGutterMarker(t,"breakpoints",o.gutterMarkers?null:e.marker())})}}}},85:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(89),r=o.n(n),i=o(150),s=o.n(i),a=o(152),u=o.n(a),c=o(151),d=o.n(c),l=o(37);t.default={name:"app",data:function(){return{currentView:"map",endpoint:"http://landregistry.data.gov.uk/landregistry/query"}},components:{GoogleMap:s.a,SparqlConsole:u.a,ResultView:d.a},methods:{openResult:function(){document.getElementById("result-button").click()},setCurrentViewResult:function(){console.log(this.$refs),this.$refs.sparqlconsole.runQuery()},runQuery:function(){var e=this,t=e.endpoint+"?query="+encodeURIComponent(e.code);l.get(t,{headers:{Accept:"application/sparql-results+json"}}).then(function(t){var o=e.parseQueryResult(t.data.results.bindings);e.$store.commit("updateQueryStatusCode",t.status),e.$store.commit("updateQueryResult",o)}).catch(function(t){t&&(e.$store.commit("updateQueryStatusCode",t.response.status),e.$store.commit("updateQueryResult",t.response.data))})},parseQueryResult:function(e){var t=this;return e.map(function(e){var o={};return r()(e).forEach(function(n){o[n]=t.dataTypeCast(e[n])}),o})},dataTypeCast:function(e){var t=e.value;if(void 0===e.datatype)return t;switch(e.datatype.replace("http://www.w3.org/2001/XMLSchema#","")){case"string":t=new String(t);break;case"boolean":t=new Boolean("false"!==t&&t);break;case"float":case"integer":case"long":case"double":case"decimal":case"nonPositiveInteger":case"nonNegativeInteger":case"negativeInteger":case"int":case"unsignedLong":case"positiveInteger":case"short":case"unsignedInt":case"byte":case"unsignedShort":case"unsignedByte":t=new Number(t);break;case"date":case"time":case"dateTime":t=new Date(t)}return t}},computed:{selectedPostcode:{get:function(){return this.$store.state.postcode},set:function(e){this.$store.commit("updatePostcode",e)}},queryResult:{get:function(){return this.$store.state.queryResult}},code:{get:function(){return this.$store.getters.code}}},watch:{queryResult:function(){this.currentView="result"}}}},86:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(94),r=o(64),i=o(63),s=o(134),a=o(37),u=o(93);t.default={name:"google-map",data:function(){return{visiblePostcodes:[],map:{},mapCenter:new window.google.maps.LatLng(51.46040383078197,-2.6015971891367826),infoWindow:new window.google.maps.InfoWindow,populatingData:!1}},mounted:function(){this.updateMapCenter();var e=this,t=document.getElementById("gmap"),o={zoom:17,center:this.mapCenter,disableDefaultUI:!0,zoomControl:!0,minZoom:17,maxZoom:18},n=new window.google.maps.Map(t,o);n.addListener("idle",function(){e.populatingData||(e.mapCenter=n.getCenter(),e.getNearbyPostcodes())}),e.map=n},methods:{updateMapCenter:function(){var e=this,t="https://api.postcodes.io/postcodes/"+this.postcode;return console.log("Centroid URL: "+t),a.get(t).then(function(t){var o=t.data.result.latitude,n=t.data.result.longitude;e.mapCenter=new window.google.maps.LatLng(o,n)}).catch(function(e){console.log("Error: "+e)})},getNearbyPostcodes:function(){var e=this;this.visiblePostcodes=[];var t="https://api.postcodes.io/postcodes?lon="+this.mapCenter.lng()+"&lat="+this.mapCenter.lat()+"&radius=300&limit=99";console.log("Nearby URL: "+t),a.get(t).then(function(t){t.data.result.forEach(function(t){var o=i.point([t.longitude,t.latitude]);o.id=t.postcode,e.visiblePostcodes.push(o)})}).then(function(){e.populateURLs()}).catch(function(e){console.log("Error: "+e)})},populateURLs:function(){this.visiblePostcodes.forEach(function(e){var t="//landregistry.data.gov.uk/data/ppi/transaction-record.json?_page=0&propertyAddress.postcode="+e.id+"&_pageSize=50";t=t.replace(" ","%20"),e.properties.url=t}),this.getData()},getData:function(){var e=this;u.map(this.visiblePostcodes,function(e){return a.get(e.properties.url).then(function(t){var o=0,n=t.data.result.items;n.forEach(function(e){o+=e.pricePaid}),e.properties.averagePaid=0===o?0:o/n.length}).catch(function(e){console.log(e)})},{concurrency:10}).then(function(){e.generateVoronoi()})},generateVoronoi:function(){var e=this,t=[];this.visiblePostcodes.forEach(function(e){t.push(e.geometry.coordinates)});var o=this.map.getBounds().getNorthEast().lat()+.005,n=this.map.getBounds().getNorthEast().lng()+.005,a=this.map.getBounds().getSouthWest().lat()-.005,u=this.map.getBounds().getSouthWest().lng()-.005,c=s.voronoi().extent([[u,a],[n,o]]),d=c(t).polygons(),l=[];d.forEach(function(t){t.reverse().push(t[0]);var o=i.polygon([t]);e.visiblePostcodes.forEach(function(e){r(e,o)&&(o.id=e.id,o.properties=e.properties,o.properties.centroid=e.geometry.coordinates)}),l.push(o)}),this.clearShapes(),this.visiblePostcodes=l,this.populateData()},clearShapes:function(){var e=this;this.map.data.forEach(function(t){e.map.data.remove(t)}),this.visiblePostcodes=[]},populateData:function(){var e=this,t=1/0,o=-1/0;this.visiblePostcodes.forEach(function(n){e.map.data.addGeoJson(n),n.properties.averagePaid>o&&(o=n.properties.averagePaid),n.properties.averagePaid<t&&(t=n.properties.averagePaid)});var r=n.scale(["#fff0a9","#e69735","#682a0f"]);this.map.data.setStyle(function(e){var n,i=e.getProperty("averagePaid"),s=(i-t)/(o-t);return n=0===i?"#ffffff":r(s),{fillColor:n,strokeWeight:1}});var i=this;this.map.data.addListener("click",function(e){i.infoWindow&&i.infoWindow.close();var t=e.feature.getProperty("centroid"),o=e.feature.getProperty("averagePaid").toLocaleString("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:2}),n="<p><b>"+e.feature.getId()+"</b></p><p>Average Price Paid: "+o+"</p>";i.infoWindow=new window.google.maps.InfoWindow({content:n,position:new window.google.maps.LatLng(t[1],t[0])}),i.postcode=e.feature.getId(),i.infoWindow.open(i.map)}),this.populatingData=!1}},computed:{postcode:{get:function(){return this.$store.state.postcode},set:function(e){this.$store.commit("updatePostcode",e)}}},watch:{mapCenter:function(){this.map.panTo(this.mapCenter)},postcode:function(e){var t=this;7===e.length&&(this.populatingData=!0,this.updateMapCenter().then(function(){t.getNearbyPostcodes()}))}}}},87:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(43),r=o.n(n),i=o(139),s=o(57),a=o(131);t.default={data:function(){return{result:this.$store.state.queryResult,statusCode:this.$store.state.queryStatusCode,message:"",requiredFields:["paon","street","town","county","propertyType","postcode","amount","date"],activeView:"data"}},mounted:function(){console.log(r()(this.result));var e=this;if(this.statusCode>399)return this.message="",void(this.activeView="json");if(0===this.result.length)this.message="No sales in "+this.postcode+" since 01/01/1995",this.activeView="json";else{this.requiredFields.every(function(t){return e.result[0].hasOwnProperty(t)})?this.visualizeData():(this.message="To visualize the data please return all of the following fields:\npaon, street, town, county, propertyType, postcode, amount, date\n\nQuery Result as JSON:",this.activeView="json")}},methods:{visualizeData:function(){for(var e=i.rowChart("#rowChart"),t=i.barChart("#barChart"),o=i.dataGrid("#dataGrid"),n=a(this.result),r=n.dimension(function(e){return e.propertyType}),u=r.group().reduceCount(function(e){return e.amount}),c=n.dimension(function(e){return e.date.toString().substring(11,15)}),d=c.group().reduce(function(e,t){return++e.count,e.total+=t.amount,e.average=e.count?e.total/e.count:0,e},function(e,t){return--e.count,e.total-=t.amount,e.average=e.count?e.total/e.count:0,e},function(){return{count:0,total:0,average:0}}),l=n.dimension(function(e){return e.date.getTime()}),p=[],f=1995;f<2018;f++)p.push(f.toString());e.width(260).height(200).group(u).dimension(r).ordinalColors(["#005E00","#0F8500","#35AB17","#5BD13D","#81F763"]).title(function(e){return e.propertyType}).elasticX(!0).turnOnControls(!0),e.xAxis().ticks(5).tickSize(2).tickPadding(10),t.width(500).height(215).dimension(c).group(d).valueAccessor(function(e){return e.value.average}).x(s.scale.ordinal().domain(p)).xUnits(i.units.ordinal).elasticY(!0).yAxisLabel("").elasticX(!0).xAxisLabel("Year").renderHorizontalGridLines(!0).gap(1).centerBar(!1).margins({top:10,right:0,bottom:45,left:65}),t.xAxis().tickFormat(function(e){return"'"+e.substring(2,4)}).tickSize(2).tickPadding(10),t.yAxis().tickFormat(function(e){return e.toLocaleString("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0,minimumFractionDigits:0})}).tickSize(2),o.dimension(l).group(function(e){return e.propertyType}).html(function(e){return"<div><b>Address:</b> "+e.paon+" "+e.street+"</div><div><b>Town:</b> "+e.town+"</div><div><b>County:</b> "+e.county+"</div><div><b>Property Type:</b> "+e.propertyType+"</div><div><b>Price Paid:</b> "+e.amount.toLocaleString("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:2})+"</div><div><b>Date:</b> "+e.date.getDate()+"/"+(e.date.getMonth()+1)+"/"+e.date.getFullYear()+"</div>"}).sortBy(function(e){return e.date.getTime()}).size(1),i.renderAll()}},computed:{postcode:{get:function(){return this.$store.state.postcode},set:function(e){this.$store.commit("updatePostcode",e)}},updatedResult:function(){this.$store.state.queryResult}},watch:{updatedResult:function(e){this.result=e,i.redrawAll()}}}},88:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(43),r=o.n(n);t.default={data:function(){return{editorOption:{inputStyle:"contenteditable",tabSize:2,foldGutter:!0,styleActiveLine:!0,lineNumbers:!0,line:!0,matchBrackets:!0,mode:"application/sparql-query",theme:"base16-light"}}},methods:{runQuery:function(){document.getElementById("result-button").click()},getIndexAt:function(e,t,o){for(var n=0,r=0;r<e.length;r++)if("\n"!==e[r]){if(n===t)return r+o}else n++},onEditorBeforeSelectionChange:function(e,t){var o=JSON.parse(r()(t.ranges));o[0].head=JSON.parse(r()(t.ranges[0].anchor)),t.update(o)},onEditorBeforeChange:function(e,t){"+delete"!==t.origin&&"+input"!==t.origin&&"setValue"!==t.origin&&t.cancel()},onEditorChanges:function(e,t){for(var o=e.getValue(),n=this.queryPrefix.length,r=n+this.postcode.length,i=0;i<t.length;i++){var s=t[i];if("+delete"===s.origin){var a=this.getIndexAt(e.getValue(),s.from.line,s.from.ch);a<n?this.queryPrefix=o.substring(0,n-1):a<r?this.postcode=o.substring(n,r-1):this.queryPostfix=o.substring(r,o.length)}else if("+input"===s.origin){var u=this.getIndexAt(e.getValue(),s.from.line,s.from.ch);u<n?this.queryPrefix=o.substring(0,n+1):u<=r?this.postcode=o.substring(n,r+1):this.queryPostfix=o.substring(r,o.length)}}console.log(this.code===o)}},computed:{postcode:{get:function(){return this.$store.state.postcode},set:function(e){this.$store.commit("updatePostcode",e)}},code:{get:function(){return this.$store.getters.code}},queryPrefix:{get:function(){return this.$store.state.queryPrefix},set:function(e){this.$store.commit("updateQueryPrefix",e)}},queryPostfix:{get:function(){return this.$store.state.queryPostfix},set:function(e){this.$store.commit("updateQueryPostfix",e)}}}}},95:function(e,t,o){function n(e){return o(r(e))}function r(e){var t=i[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var i={"./meta.js":44,"./sparql/sparql.js":96};n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id=95},97:function(e,t,o){function n(e){return o(r(e))}function r(e){var t=i[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var i={"./base16-dark.css":141,"./base16-light.css":142};n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id=97}},[83]);
//# sourceMappingURL=app.8537f1fdb7564c9aeaf6.js.map